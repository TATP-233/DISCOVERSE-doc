---
sidebar_position: 2
---

# ç«‹ä½“ç›¸æœºä»¿çœŸè¯¦è§£

## æ¦‚è¿°

ç«‹ä½“ç›¸æœºæ˜¯æœºå™¨äººæ„ŸçŸ¥ç³»ç»Ÿä¸­çš„é‡è¦ç»„ä»¶ï¼Œå®ƒé€šè¿‡æ¨¡æ‹ŸåŒçœ¼è§†è§‰æ¥è·å–æ·±åº¦ä¿¡æ¯ã€‚DISCOVERSEé›†æˆäº†å¼ºå¤§çš„ç«‹ä½“ç›¸æœºä»¿çœŸåŠŸèƒ½ï¼Œæ”¯æŒé«˜è´¨é‡çš„RGBå’Œæ·±åº¦å›¾åƒæ¸²æŸ“ï¼Œä»¥åŠçµæ´»çš„ç›¸æœºè½¨è¿¹è§„åˆ’ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬æ•™ç¨‹åï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

- ç†è§£ç«‹ä½“è§†è§‰çš„åŸºæœ¬åŸç†
- æŒæ¡`camera_view.py`å·¥å…·çš„ä½¿ç”¨
- é…ç½®åŒç›®ç›¸æœºå‚æ•°
- æ‰§è¡Œç›¸æœºè½¨è¿¹æ’å€¼å’Œæ•°æ®é‡‡é›†
- è§£æè§‚æµ‹æ•°æ®ç»“æ„

## ğŸ“‹ å‰ç½®è¦æ±‚

- å®ŒæˆåŸºç¡€ä»¿çœŸæ•™ç¨‹
- å®‰è£…3Dé«˜æ–¯æ¸²æŸ“ä¾èµ–ï¼ˆå¯é€‰ï¼Œç”¨äºé«˜ä¿çœŸæ¸²æŸ“ï¼‰
- å‡†å¤‡3DGSæ¨¡å‹æ–‡ä»¶ï¼ˆ.plyæ ¼å¼ï¼‰

## ç«‹ä½“è§†è§‰åŸç†

### ä»€ä¹ˆæ˜¯ç«‹ä½“ç›¸æœºï¼Ÿ

ç«‹ä½“ç›¸æœºç³»ç»Ÿæ¨¡ä»¿äººç±»åŒçœ¼è§†è§‰ï¼Œç”±ä¸¤ä¸ªå¹¶æ’æ”¾ç½®çš„ç›¸æœºç»„æˆï¼š

```mermaid
graph TD
    A[å·¦ç›¸æœº] --> C[ç«‹ä½“å›¾åƒå¯¹]
    B[å³ç›¸æœº] --> C
    C --> D[è§†å·®è®¡ç®—]
    D --> E[æ·±åº¦ä¿¡æ¯]
```

### æ ¸å¿ƒæŠ€æœ¯åŸç†

1. **ä¸‰è§’æµ‹é‡æ³•**ï¼šé€šè¿‡ä¸¤ä¸ªç›¸æœºçš„ä¸åŒè§†è§’è®¡ç®—æ·±åº¦
2. **åŸºçº¿è·ç¦»**ï¼šä¸¤ç›¸æœºé—´çš„è·ç¦»ï¼Œå½±å“æ·±åº¦æ„ŸçŸ¥ç²¾åº¦
3. **è§†å·®**ï¼šåŒä¸€ç‰©ä½“åœ¨å·¦å³å›¾åƒä¸­çš„ä½ç½®å·®å¼‚

## å·¥å…·ä»‹ç»ï¼šcamera_view.py

`discoverse/examples/active_slam/camera_view.py` æ˜¯DISCOVERSEçš„æ ¸å¿ƒç«‹ä½“ç›¸æœºå·¥å…·ï¼Œæä¾›ï¼š

### ğŸ”§ ä¸»è¦åŠŸèƒ½

- **å®æ—¶åŒç›®æ¸²æŸ“**ï¼šé«˜è´¨é‡RGB+æ·±åº¦å›¾åƒ
- **äº¤äº’å¼ç›¸æœºæ§åˆ¶**ï¼šé”®ç›˜é¼ æ ‡æ“ä½œ
- **ç›¸æœºè½¨è¿¹è§„åˆ’**ï¼šå…³é”®å¸§ä¿å­˜ä¸æ’å€¼
- **æ•°æ®æ‰¹é‡å¯¼å‡º**ï¼šæ”¯æŒå¤§è§„æ¨¡æ•°æ®é›†ç”Ÿæˆ

### ğŸ® æ§åˆ¶æ–¹å¼

#### ç›¸æœºç§»åŠ¨
- `W/S` - å‰è¿›/åé€€
- `A/D` - å·¦ç§»/å³ç§»  
- `Q/E` - ä¸Šå‡/ä¸‹é™
- `Shift + ç§»åŠ¨é”®` - åŠ é€Ÿç§»åŠ¨

#### è§†è§’æ—‹è½¬
- `é¼ æ ‡å·¦é”®æ‹–æ‹½` - æ—‹è½¬è§†è§’
- `ESC` - åˆ‡æ¢è‡ªç”±ç›¸æœºæ¨¡å¼
- `[/]` - åˆ‡æ¢ä¼ æ„Ÿå™¨ç›¸æœº

#### åŠŸèƒ½å¿«æ·é”®
- `Space` - ä¿å­˜å½“å‰ç›¸æœºä½å§¿
- `I` - å¯¼å‡ºç›¸æœºä½å§¿åˆ—è¡¨
- `Ctrl+G` - åˆ‡æ¢é«˜æ–¯æ¸²æŸ“
- `Ctrl+D` - åˆ‡æ¢æ·±åº¦å¯è§†åŒ–

## å®é™…æ“ä½œæŒ‡å—

### 1. åŸºç¡€å¯åŠ¨

```bash
# å¯åŠ¨äº¤äº’æ¨¡å¼
python discoverse/examples/active_slam/camera_view.py \
    --gsply /path/to/scene.ply \
    --show-gui

# åŒæ—¶åŠ è½½ç½‘æ ¼æ¨¡å‹
python discoverse/examples/active_slam/camera_view.py \
    --gsply /path/to/scene.ply \
    --mesh /path/to/scene.obj \
    --show-gui
```

### 2. å‚æ•°é…ç½®

#### ç›¸æœºå‚æ•°
```bash
--camera-distance 0.06    # åŸºçº¿è·ç¦»ï¼ˆç±³ï¼‰
--fovy 60.0              # å‚ç›´è§†åœºè§’ï¼ˆåº¦ï¼‰
--width 1280             # å›¾åƒå®½åº¦
--height 720             # å›¾åƒé«˜åº¦
--max-depth 10.0         # æœ€å¤§æ·±åº¦å€¼
```

#### å®Œæ•´ç¤ºä¾‹
```bash
python discoverse/examples/active_slam/camera_view.py \
    --gsply models/3dgs/kitchen/kitchen.ply \
    --camera-distance 0.06 \
    --fovy 75.0 \
    --width 1920 \
    --height 1080 \
    --show-gui
```

### 3. ç›¸æœºè½¨è¿¹è®¾è®¡å·¥ä½œæµ

#### é˜¶æ®µä¸€ï¼šå…³é”®å¸§è®¾è®¡
1. **å¯åŠ¨ç¨‹åº**ï¼ˆåŒ…å«GUIï¼‰
2. **æ¢ç´¢åœºæ™¯**ï¼šä½¿ç”¨WASDé”®å¯¼èˆª
3. **è®¾ç½®å…³é”®ç‚¹**ï¼šåœ¨é‡è¦ä½ç½®æŒ‰`Space`ä¿å­˜
4. **ç®¡ç†è§†ç‚¹**ï¼šåœ¨GUIä¸­æŸ¥çœ‹å’Œç¼–è¾‘å·²ä¿å­˜ä½å§¿
5. **å¯¼å‡ºæ•°æ®**ï¼šæŒ‰`I`é”®ä¿å­˜ä¸º`camera_list.json`

#### é˜¶æ®µäºŒï¼šè½¨è¿¹æ’å€¼ä¸æ•°æ®é‡‡é›†
```bash
python discoverse/examples/active_slam/camera_view.py \
    --gsply /path/to/scene.ply \
    --camera-pose-path camera_list.json \
    --num-interpolate 100
```

### 4. æ’å€¼ç®—æ³•è¯¦è§£

DISCOVERSEä½¿ç”¨å…ˆè¿›çš„æ’å€¼æŠ€æœ¯ç¡®ä¿ç›¸æœºè¿åŠ¨çš„å¹³æ»‘æ€§ï¼š

- **ä½ç½®æ’å€¼**ï¼šä¸‰æ¬¡æ ·æ¡æ’å€¼ï¼ˆCubic Splineï¼‰
- **æ—‹è½¬æ’å€¼**ï¼šçƒé¢çº¿æ€§æ’å€¼ï¼ˆSLERPï¼‰

```python
# æ’å€¼ç»“æœè‡ªåŠ¨ä¿å­˜åˆ°
interpolate_viewpoints/
â”œâ”€â”€ rgb_img_0_0.png      # å·¦ç›¸æœºRGBå›¾åƒ
â”œâ”€â”€ rgb_img_1_0.png      # å³ç›¸æœºRGBå›¾åƒ  
â”œâ”€â”€ depth_img_0_0.npy    # å·¦ç›¸æœºæ·±åº¦æ•°æ®
â”œâ”€â”€ depth_img_1_0.npy    # å³ç›¸æœºæ·±åº¦æ•°æ®
â”œâ”€â”€ camera_poses_cam1.json # å·¦ç›¸æœºå¤–å‚
â””â”€â”€ camera_poses_cam2.json # å³ç›¸æœºå¤–å‚
```

## è§‚æµ‹æ•°æ®è§£æ

### æ•°æ®ç»“æ„è¯¦è§£

é€šè¿‡`robot.getObservation()`è·å–çš„è§‚æµ‹æ•°æ®ï¼š

```python
obs = {
    'rgb_cam_posi': [              # RGBç›¸æœºä½å§¿åˆ—è¡¨
        (position, quaternion),     # æ¯ä¸ªç›¸æœºçš„6DOFä½å§¿
        ...
    ],
    'depth_cam_posi': [...],       # æ·±åº¦ç›¸æœºä½å§¿åˆ—è¡¨
    'rgb_img': {                   # RGBå›¾åƒå­—å…¸
        0: numpy_array,            # å·¦ç›¸æœºå›¾åƒ (H,W,3)
        1: numpy_array,            # å³ç›¸æœºå›¾åƒ (H,W,3)
    },
    'depth_img': {                 # æ·±åº¦å›¾åƒå­—å…¸
        0: numpy_array,            # å·¦ç›¸æœºæ·±åº¦ (H,W)
        1: numpy_array,            # å³ç›¸æœºæ·±åº¦ (H,W)
    }
}
```

### åæ ‡ç³»å®šä¹‰

DISCOVERSEä½¿ç”¨ç»Ÿä¸€çš„ç›¸æœºåæ ‡ç³»ï¼š
- **Zè½´**ï¼šæŒ‡å‘ç›¸æœºå‰æ–¹ï¼ˆè§†çº¿æ–¹å‘ï¼‰
- **Yè½´**ï¼šæŒ‡å‘ç›¸æœºä¸‹æ–¹
- **Xè½´**ï¼šæŒ‡å‘ç›¸æœºå³æ–¹

### ä»£ç ç¤ºä¾‹

```python
import numpy as np
from discoverse.envs.simulator import Simulator

# åˆå§‹åŒ–ä»¿çœŸå™¨
sim = Simulator(mjcf_path="models/mjcf/camera_env.xml")

# è·å–è§‚æµ‹
obs = sim.getObservation()

# è®¿é—®ç«‹ä½“å›¾åƒ
left_rgb = obs['rgb_img'][0]      # å·¦ç›¸æœºRGB
right_rgb = obs['rgb_img'][1]     # å³ç›¸æœºRGB
left_depth = obs['depth_img'][0]  # å·¦ç›¸æœºæ·±åº¦

# è·å–ç›¸æœºä½å§¿
left_pos, left_quat = obs['rgb_cam_posi'][0]
print(f"å·¦ç›¸æœºä½ç½®: {left_pos}")
print(f"å·¦ç›¸æœºå§¿æ€: {left_quat}")

# è®¡ç®—è§†å·®å›¾ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰
def compute_disparity(left, right):
    """è®¡ç®—è§†å·®å›¾çš„ç®€åŒ–ç¤ºä¾‹"""
    # å®é™…åº”ç”¨ä¸­éœ€è¦ä½¿ç”¨ç«‹ä½“åŒ¹é…ç®—æ³•
    disparity = np.abs(left.astype(float) - right.astype(float))
    return disparity.mean(axis=2)  # è½¬ä¸ºç°åº¦

disparity = compute_disparity(left_rgb, right_rgb)
```
